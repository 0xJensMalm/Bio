<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bacterial Energy Automaton ‚Äî minimal & extensible</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>üß´ BIO v0.5</h1>
  </header>

  <div class="board-wrap">
    <canvas id="view" width="600" height="400" aria-label="Simulation view"></canvas>
    <canvas id="overlay" width="600" height="400" aria-label="Bacteria overlay"></canvas>
    <div class="hud" id="hud" style="display:none"></div>
    <div class="mini-charts" id="miniCharts">
      <canvas id="chartCountOverlay" aria-label="Bacteria over time"></canvas>
      <canvas id="chartFoodOverlay" aria-label="Avg food over time"></canvas>
    </div>
  </div>

  <div class="world-bar">
    <div class="world-left">
      <div class="world-item"><label class="clickable" id="btnGrid">Grid (W√óH)</label><span class="value" id="gridSize">150√ó100</span></div>
      <div class="world-item"><label>Pixel scale</label><span class="value" id="pxScale">4</span></div>
      <div class="world-item"><label>Initial bacteria</label><input id="initB" type="number" step="1" value="150"></div>
      <div class="world-item"><label>Random seed</label><input id="rngSeed" type="text" value="42"></div>
      <div class="world-item">
        <div class="btns">
          <button id="btnToggle" class="primary">‚ñ∂Ô∏è Start</button>
          <button id="btnStep">Step</button>
          <button id="btnReset" class="warn">Reset</button>
          <button id="btnSeedB" title="Add bacteria">+ Bacteria</button>
          <button id="btnSeedF" title="Re-seed food field">Re-seed Food</button>
          <span class="speed-wrap"><label style="display:inline-block; min-width:40px">Speed</label>
          <input id="speed" type="range" min="1" max="3" step="1" value="1" /></span>
          <div class="legend">
            <span class="legend-item"><span id="swatchBact" class="swatch" style="background:#000000"></span>Bacteria</span>
            <span class="legend-item"><span id="swatchHigh" class="swatch" style="background:#00ff00"></span>Food high</span>
            <span class="legend-item"><span id="swatchLow" class="swatch" style="background:#ffff00"></span>Food low</span>
            <span class="legend-item"><span id="swatchEmpty" class="swatch" style="background:#ffffff"></span>Empty</span>
          </div>
        </div>
      </div>
    </div>
    <div class="world-spacer"></div>
    <div class="world-right">
      <button id="tabBio" class="primary">Bio</button>
      <button id="tabVisuals">Visuals</button>
      <button id="tabEco">Ecosystem builder</button>
      <button id="tabDraw">Save &amp; Presets</button>
    </div>
  </div>
  

  <div class="panel" id="bioPanel">

    <div class="section">
      <h3>Biology params</h3>
      <div class="row"><label title="Max uptake rate in Monod kinetics. Higher = faster consumption at high food.">u_max</label><input id="u_max" type="range" min="0" max="2" step="0.01" value="1.0"><span class="value" data-val="u_max">1.00</span></div>
      <div class="row"><label title="Half-saturation constant in Monod uptake. Lower = better at low food.">K (half-sat)</label><input id="K" type="range" min="0.01" max="1.0" step="0.01" value="0.2"><span class="value" data-val="K">0.20</span></div>
      <div class="row"><label title="Baseline energy cost per tick. Higher = higher starvation risk.">Maintenance (c_maint)</label><input id="c_maint" type="range" min="0" max="0.5" step="0.01" value="0.10"><span class="value" data-val="c_maint">0.10</span></div>
      <div class="row"><label title="Yield factor: fraction of consumed food converted to internal energy.">Yield to energy (Y_E)</label><input id="Y_E" type="range" min="0.1" max="2.0" step="0.01" value="1.0"><span class="value" data-val="Y_E">1.00</span></div>
      <div class="row"><label title="Energy threshold for a bacterium to divide.">Division threshold (E_div)</label><input id="E_div" type="range" min="0.5" max="6.0" step="0.1" value="3.0"><span class="value" data-val="E_div">3.0</span></div>
      <div class="row"><label title="Energy granted to a newborn cell upon division.">Offspring energy (E_new)</label><input id="E_new" type="range" min="0.5" max="3.0" step="0.1" value="1.5"><span class="value" data-val="E_new">1.5</span></div>
    </div>

    <div class="section">
      <h3>Food field</h3>
      <div class="row"><label title="Diffusion coefficient of the food field between neighboring tiles.">Diffusion (D)</label><input id="D" type="range" min="0" max="0.5" step="0.01" value="0.10"><span class="value" data-val="D">0.10</span></div>
      <div class="row"><label title="Replenishment rate toward carrying capacity Fmax per tick.">Replenish (r)</label><input id="r" type="range" min="0" max="0.05" step="0.001" value="0.01"><span class="value" data-val="r">0.010</span></div>
      <div class="row"><label title="Carrying capacity (maximum) of food concentration.">F_max</label><input id="Fmax" type="range" min="0.1" max="2.0" step="0.1" value="1.0"><span class="value" data-val="Fmax">1.0</span></div>
      <div class="row"><label title="Fractional decay of food each tick.">Decay (Œ¥)</label><input id="delta" type="range" min="0" max="0.1" step="0.001" value="0.00"><span class="value" data-val="delta">0.000</span></div>
      <div class="row"><label title="Random noise amplitude when seeding the food field.">Seed noise</label><input id="seedNoise" type="range" min="0" max="1.0" step="0.01" value="0.35"><span class="value" data-val="seedNoise">0.35</span></div>
    </div>

    

    <div class="section">
      <h3>Legend</h3>
      <div class="small">Food field = dark‚Üíbright. Bacteria = pale green pixels. Division places offspring in a random neighboring tile. No movement by default (add easily).</div>
    </div>
  </div>

  <div class="panel" id="visualsPanel" style="display:none">
    <div class="section">
      <h3>Themes</h3>
      <div class="row"><label>Food empty</label><input type="color" id="thFoodEmpty" value="#ffffff"></div>
      <div class="row"><label>Food low</label><input type="color" id="thFoodLow" value="#ffff00"></div>
      <div class="row"><label>Food high</label><input type="color" id="thFoodHigh" value="#00ff00"></div>
      <div class="row"><label>Bacteria</label><input type="color" id="thBacteria" value="#000000"></div>
      <div class="row"><label>Gamma</label><input type="range" id="fxGamma" min="0.5" max="2.0" step="0.05" value="1.0"><span class="value" data-val="fxGamma">1.00</span></div>
      <div class="row"><label>Tracers</label><input type="range" id="fxTrace" min="0" max="1" step="0.05" value="0.4"><span class="value" data-val="fxTrace">0.40</span></div>
      <div class="btns">
        <button id="btnThemeApply" class="primary">Apply</button>
      </div>
    </div>
  </div>

  <div class="panel" id="drawPanel" style="display:none">
    <div class="section">
      <h3>Save &amp; Presets</h3>
      <div class="row"><button id="btnPresetDefault" class="primary">Default</button><span class="small">Reset all parameters to defaults.</span></div>
      <div class="row"><label>Name</label><input id="presetName" type="text" placeholder="My preset" style="width:140px"><button id="btnSavePreset">Save preset</button></div>
      <div class="row"><label>My presets</label><div id="presetList" class="small"></div></div>
      <div class="row"><label>Export</label><button id="btnExportPresets">Download JSON</button></div>
      <div class="row"><label>Import</label><input id="fileImportPresets" type="file" accept="application/json"></div>
    </div>
  </div>

  <div class="panel" id="ecoPanel" style="display:none">
    <div class="section">
      <h3>Ecosystem builder</h3>
      <div class="row"><label>Clear all</label><button id="btnClearAll" class="warn">Clear all</button><span class="small">Removes food, bacteria and obstacles.</span></div>
      <div class="row"><label>Brush</label>
        <div class="btns" id="brushGroup">
          <button id="btnBrushFood" class="primary">Food</button>
          <button id="btnBrushObstacle">Obstacle</button>
          <button id="btnBrushBacteria">Bacteria</button>
        </div>
      </div>
      <div class="row"><label>Size</label><input id="brushSize" type="range" min="1" max="20" step="1" value="5"></div>
      <div class="row"><label>Strength</label><input id="brushStrength" type="range" min="0.1" max="1.0" step="0.1" value="0.6"></div>
      <div class="row"><label>Movement</label><input id="moveRate" type="range" min="0" max="1" step="0.05" value="0.20"><span class="value" data-val="moveRate">0.20</span></div>
      <div class="small">Click or drag on the grid to paint. Obstacles block diffusion and bacteria. Movement lets bacteria wander while consuming food.</div>
    </div>
  </div>

  

  <!-- Info Modal -->
  <div class="modal-backdrop" id="paramModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="paramModalTitle">
      <h4 id="paramModalTitle">Parameter</h4>
      <p id="paramModalBody">Description</p>
      <div class="actions"><button id="paramModalClose" class="primary">Close</button></div>
    </div>
  </div>
  <!-- Welcome Modal -->
  <div class="modal-backdrop" id="welcomeModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="welcomeTitle">
      <h4 id="welcomeTitle">Welcome to BIO</h4>
      <p>
        BIO is a bacterial growth simulation sandbox inspired by real microbial dynamics. By tuning both the internal biology (uptake, maintenance, yield, division) and the external food field (diffusion, replenish, capacity, decay), emergent behaviors appear: expanding fronts, patchy blooms, depletion rings, and boom‚Äìbust cycles.

        Current features:
        - Speed slider: adjust simulation speed in real time
        - Bio: live‚Äëtweak biology and food parameters; observe immediate effects
        - Visuals (WIP): recolor the field and bacteria, tweak gamma and tracers
        - Save & Presets: save/import/export parameter sets; Ecosystem builder to paint Food, Obstacles, and Bacteria manually
      </p>
      <div class="row" style="margin-top:8px">
        <label><input type="checkbox" id="welcomeDont" /> Don‚Äôt show this again</label>
      </div>
      <div class="actions"><button id="welcomeStart" class="primary">Let‚Äôs start</button></div>
    </div>
  </div>
  <script src="sim.js"></script>
  <script src="visuals.js"></script>
  <script src="panels.js"></script>
  <script src="script.js"></script>
</body>
</html>
