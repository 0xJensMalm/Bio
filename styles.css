:root {
  --bg: #0f1220;
  --panel: #14182a;
  --panel-2: #0d1020;
  --accent: #7ae582;
  --text: #e8eaf6;
  --muted: #9aa3b2;
  --warn: #ffb703;
  --danger: #ef476f;
}
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }
body {
  background: radial-gradient(1200px 800px at 65% 30%, #151a33, var(--bg));
  color: var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  display: grid; grid-template-columns: 1fr 360px; gap: 14px; padding: 14px;
  grid-template-areas:
    "header header"
    "world world"
    "board panel"
    "insights insights";
}
header { grid-column: 1 / span 2; display: flex; align-items: center; gap: 10px; grid-area: header; }
header h1 { font-size: 18px; margin: 0; letter-spacing: .3px; }
header .sub { color: var(--muted); font-size: 12px; }

.board-wrap { position: relative; background: #0b0e1a; border: 1px solid #20264a; border-radius: 14px; padding: 10px; display: grid; align-content: start; grid-area: board; }
canvas { image-rendering: pixelated; width: 100%; height: auto; border-radius: 10px; display: block; background: #000; }
.board-wrap { position: relative; }
#overlay { position: absolute; inset: 10px; width: calc(100% - 20px); height: auto; pointer-events: none; border-radius: 10px; background: transparent; }

.hud {
  position: absolute; left: 16px; top: 14px; padding: 8px 10px; border-radius: 10px;
  background: rgba(10,12,24,.62); border: 1px solid rgba(122,229,130,.18);
  font-size: 12px; line-height: 1.35; color: #e6ffe8;
  backdrop-filter: blur(4px);
}
.hud strong { color: var(--accent); }

.panel { background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid #232a4f; border-radius: 14px; padding: 14px; display: grid; gap: 14px; max-height: calc(100vh - 80px); overflow: auto; grid-area: panel; }
.ctrl { display: flex; align-items: center; gap: 8px; }
.row input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  height: 6px;
  background: #1a1f3a;
  border: 1px solid #2a3262;
  border-radius: 999px;
}
.row input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px; height: 16px; border-radius: 50%;
  background: var(--accent);
  border: 1px solid #295c3a;
  box-shadow: 0 0 10px rgba(122,229,130,.4);
}
.row input[type="range"]::-moz-range-thumb {
  width: 16px; height: 16px; border: none; border-radius: 50%;
  background: var(--accent);
  box-shadow: 0 0 10px rgba(122,229,130,.4);
}
.section { border: 1px solid #1e2447; border-radius: 12px; padding: 12px; background: rgba(255,255,255,.02); }
.section h3 { margin: 0 0 8px; font-size: 13px; color: #c6d0ff; letter-spacing: .4px; }
.row { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; margin: 6px 0; }
.row label { font-size: 12px; color: var(--muted); }
.row label[title] { cursor: help; text-decoration: underline dotted rgba(198,208,255,.4); text-underline-offset: 2px; }
.row input[type="number"], .row input[type="range"], .row input[type="text"] {
  width: 120px; background: #0a0e20; color: var(--text); border: 1px solid #28305a; border-radius: 8px; padding: 6px 8px; font-size: 12px;
}
.row input[type="range"] { width: 160px; }
.row .value { font-variant-numeric: tabular-nums; font-size: 12px; color: #d7e3ff; }

.btns { display: flex; gap: 8px; flex-wrap: wrap; }
button { background: #0a0e20; color: var(--text); border: 1px solid #2a3262; border-radius: 10px; padding: 8px 10px; font-size: 12px; cursor: pointer; }
button.primary { border-color: #295c3a; background: linear-gradient(180deg, #133022, #0d1d15); color: #d6ffe0; }
button.warn { border-color: #6c4a0e; background: linear-gradient(180deg, #2a1f0b, #171103); color: #ffe9b2; }
button.danger { border-color: #612033; background: linear-gradient(180deg, #2a0b13, #16070b); color: #ffd0dc; }
button:disabled { opacity: .55; cursor: default; }

.small { font-size: 11px; color: var(--muted); }
.preset { display: inline-block; margin: 4px 6px 0 0; }


/* Knobs */
.knob-grid { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 12px; }
.knob { display: grid; grid-template-rows: auto 1fr auto; align-items: center; justify-items: center; text-align: center; padding: 10px; border: 1px solid #1e2447; border-radius: 12px; background: rgba(255,255,255,.02); }
.knob__title { font-size: 12px; color: var(--muted); }
.knob__dial { width: 80px; height: 80px; margin: 6px 0; border-radius: 50%; background: radial-gradient(40px 40px at 50% 50%, #0c1022, #070a18); border: 1px solid #27305a; position: relative; cursor: grab; box-shadow: inset 0 4px 10px rgba(0,0,0,.4); }
.knob__dial:active { cursor: grabbing; }
.knob__dial::after { content: ""; position: absolute; inset: 8px; border-radius: 50%; border: 1px solid rgba(255,255,255,.04); }
.knob__indicator { position: absolute; left: 50%; top: 50%; width: 3px; height: 34px; background: var(--accent); border-radius: 2px; box-shadow: 0 0 6px rgba(122,229,130,.6); transform-origin: top center; transform: translate(-50%, 0) rotate(-135deg); }
.knob__value { font-variant-numeric: tabular-nums; font-size: 12px; color: #d7e3ff; }
.knob input[type="hidden"] { display: none; }

/* World bar */
.world-bar {
  grid-column: 1 / span 2;
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: start;
  gap: 10px 16px;
  padding: 10px 12px;
  border: 1px solid #232a4f;
  border-radius: 12px;
  background: linear-gradient(180deg, var(--panel), var(--panel-2));
  grid-area: world;
}
.world-left { display: flex; flex-wrap: wrap; align-items: center; gap: 10px 14px; }
.world-right { display: flex; align-items: center; justify-content: flex-end; }
.world-spacer { display: none; }
.world-item input[type="number"], .world-item input[type="text"] { width: 60px; background: #0a0e20; color: var(--text); border: 1px solid #28305a; border-radius: 8px; padding: 6px 8px; font-size: 12px; }
.world-left .btns label, .world-left .btns input[type="range"] { margin-top: 4px; }

.draw-bar { grid-column: 1 / span 2; display: flex; flex-wrap: wrap; gap: 10px 14px; align-items: center; padding: 8px 12px; border: 1px solid #232a4f; border-radius: 12px; background: linear-gradient(180deg, var(--panel), var(--panel-2)); }
.draw-item { display: flex; align-items: center; gap: 8px; }
.draw-item select { background: #0a0e20; color: var(--text); border: 1px solid #28305a; border-radius: 8px; padding: 6px 8px; font-size: 12px; }
.draw-tools { display: flex; align-items: center; gap: 10px; }
.world-bar input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  height: 6px;
  background: #1a1f3a;
  border: 1px solid #2a3262;
  border-radius: 999px;
}
.world-bar input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px; height: 16px; border-radius: 50%;
  background: var(--accent);
  border: 1px solid #295c3a;
  box-shadow: 0 0 10px rgba(122,229,130,.4);
}
.world-bar input[type="range"]::-moz-range-thumb {
  width: 16px; height: 16px; border: none; border-radius: 50%;
  background: var(--accent);
  box-shadow: 0 0 10px rgba(122,229,130,.4);
}
.clickable { cursor: pointer; text-decoration: underline dotted rgba(198,208,255,.4); text-underline-offset: 2px; }

/* Insights */
.insights { grid-area: insights; display: grid; gap: 14px; }
.insights .cards { display: grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap: 10px; }
.insights .card { background: rgba(255,255,255,.02); border: 1px solid #232a4f; border-radius: 12px; padding: 10px; display: grid; gap: 6px; justify-items: start; }
.insights .card-title { font-size: 11px; color: var(--muted); }
.insights .card-value { font-variant-numeric: tabular-nums; font-size: 18px; color: #e6f5ff; }
.insights .charts { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 12px; align-items: start; }
.insights .chart { display: grid; gap: 6px; }
.insights .chart-title { font-size: 12px; color: #c6d0ff; }
.insights .chart-desc { font-size: 11px; color: var(--muted); }
.insights canvas { width: 100%; height: 120px; background: #0b0e1a; border: 1px solid #20264a; border-radius: 10px; }
.world-item { display: flex; align-items: center; gap: 8px; }
.world-item label { font-size: 12px; color: var(--muted); }

/* Modal */
.modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: none; align-items: center; justify-content: center; z-index: 50; }
.modal { width: min(520px, calc(100vw - 40px)); background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid #232a4f; border-radius: 12px; padding: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.6); }
.modal h4 { margin: 0 0 8px; font-size: 14px; color: #c6d0ff; letter-spacing: .3px; }
.modal p { margin: 0; font-size: 12px; color: #d7e3ff; line-height: 1.5; white-space: pre-line; }
.modal .actions { display: flex; justify-content: flex-end; margin-top: 12px; }
.modal .actions button { padding: 6px 10px; border-radius: 8px; }
.modal-open { display: flex; }


